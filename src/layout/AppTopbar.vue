<script setup>
import { ref, onMounted, onBeforeUnmount } from "vue";
import { useToast } from "primevue/usetoast";
import { useLayout } from "@/layout/composables/layout";
import Menu from "primevue/menu";
import Tag from "primevue/tag";
import Avatar from "primevue/avatar";
import Dialog from "primevue/dialog";
import InputText from "primevue/inputtext";
import Password from "primevue/password";
import Button from "primevue/button";
import { getCurrentUser, logoutUserLog, resetUserPassword } from "@/api/auth";
import { useCurrentUser } from "@/service/CurrentUser";

const { toggleMenu, toggleDarkMode, isDarkTheme } = useLayout();

const toast = useToast();

const settingsForm = ref({
  name: "",
  email: "",
  image_url: "",
  password: "",
});
const confirmPassword = ref("");
const settingsError = ref("");
const imagePreview = ref(null);

const menu = ref();
const showConfigurator = ref(false);

const { user, setUser } = useCurrentUser();

// This is the only image upload handler needed!
function handleImageUpload(e) {
  const file = e.target.files[0];
  if (file) {
    settingsForm.value.image = file;
    imagePreview.value = URL.createObjectURL(file);
  }
}

function closeMenuOnScroll() {
  if (menu.value) {
    menu.value.hide();
  }
}

onMounted(() => {
  window.addEventListener("scroll", closeMenuOnScroll, true);
});
onBeforeUnmount(() => {
  window.removeEventListener("scroll", closeMenuOnScroll, true);
});

function openSettings() {
  settingsForm.value.name = user.value.name || "";
  settingsForm.value.email = user.value.email || "";
  settingsForm.value.image_url = user.value.image_url || "";
  settingsForm.value.password = "";
  confirmPassword.value = "";
  settingsError.value = "";
  showConfigurator.value = true;
}


function isValidEmail(email) {
  return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
}

function closeConfigurator() {
  showConfigurator.value = false;
}


async function saveSettings() {
  settingsError.value = "";

  // Password is optionalâ€”only change if provided
  if (settingsForm.value.password || confirmPassword.value) {
    if (!settingsForm.value.password || !confirmPassword.value) {
      settingsError.value = "Please fill in both password fields.";
      toast.add({ severity: "warn", summary: "Missing", detail: settingsError.value, life: 2500 });
      return;
    }
    if (settingsForm.value.password !== confirmPassword.value) {
      settingsError.value = "Passwords do not match.";
      toast.add({ severity: "warn", summary: "Mismatch", detail: settingsError.value, life: 2500 });
      return;
    }
    try {
      const userId = localStorage.getItem("userId");
      await resetUserPassword(userId, { new_password: settingsForm.value.password });
      const res = await getCurrentUser(userId);
      setUser(res.data.user);
      toast.add({ severity: "success", summary: "Saved", detail: "Password updated.", life: 2000 });
    } catch (err) {
      settingsError.value = "Failed to update password.";
      toast.add({ severity: "error", summary: "Error", detail: settingsError.value, life: 3000 });
      return;
    }
  }

  showConfigurator.value = false;
}


// User menu
const userMenuItems = [
  {
    label: "Settings",
    icon: "pi pi-cog",
    command: openSettings
  },
  {
    label: "Log Out",
    icon: "pi pi-sign-out",
    command: async () => {
      try {
        const userId = localStorage.getItem("userId");
        if (userId) {
          await logoutUserLog(userId);
        }
      } catch (e) {}
      localStorage.removeItem("token");
      localStorage.removeItem("userId");
      window.location.href = "/pages/auth/login";
    }
  }
];

// Fetch user info on mount
onMounted(async () => {
  try {
    const userId = localStorage.getItem("userId");
    if (!userId) {
      window.location.href = "/pages/auth/login";
      return;
    }
    const res = await getCurrentUser(userId);
    setUser(res.data.user);
  } catch (err) {
    window.location.href = "/pages/auth/login";
  }
});
</script>


<template>
    <div class="layout-topbar">
        <div class="layout-topbar-logo-container">
            <button
                class="layout-menu-button layout-topbar-action"
                @click="toggleMenu"
            >
                <i class="pi pi-bars"></i>
            </button>
            <router-link to="/" class="layout-topbar-logo">
                <svg viewBox="0 0 1630 972" xmlns="http://www.w3.org/2000/svg" style="width: 48px !important; height: auto !important; max-height: 32px !important;">
<path d="M0 0 C49.44614031 -0.95841332 99.12624292 5.53429537 146.14404297 21.06640625 C147.29598145 21.44667969 148.44791992 21.82695312 149.63476562 22.21875 C218.12923258 45.14105138 283.5117779 87.57137035 328.14404297 145.06640625 C328.60810547 145.65260742 329.07216797 146.23880859 329.55029297 146.84277344 C342.82411047 163.61281966 354.76692089 181.36048803 365.14404297 200.06640625 C365.83530273 201.30535645 365.83530273 201.30535645 366.54052734 202.56933594 C387.51592209 240.50147504 400.60871692 281.51397678 408.14404297 324.06640625 C408.32354492 323.28555664 408.50304687 322.50470703 408.68798828 321.70019531 C415.77019131 291.28111905 424.6497856 261.31726815 438.14404297 233.06640625 C438.49418457 232.33131836 438.84432617 231.59623047 439.20507812 230.83886719 C441.12294479 226.84904414 443.11008383 222.90056143 445.15527344 218.97460938 C446.16899567 217.01825061 447.15912882 215.05107775 448.14794922 213.08203125 C457.21129427 195.25215245 468.18460969 178.62850445 480.62548828 162.98632812 C482.09668553 161.12628066 483.54198962 159.2490719 484.97998047 157.36328125 C490.45733447 150.21399537 496.26078605 143.51069294 502.43701172 136.95703125 C504.58860395 134.65951574 506.66664138 132.33670836 508.70654297 129.94140625 C515.56144097 122.03319465 523.17975735 114.83951176 531.14404297 108.06640625 C532.58070313 106.79603516 532.58070313 106.79603516 534.04638672 105.5 C591.0510633 55.32801718 663.10074152 23.78989725 737.89404297 12.31640625 C739.18262207 12.11764893 740.47120117 11.9188916 741.79882812 11.71411133 C761.93535109 8.76727228 781.86772147 7.71652427 802.21777344 7.75073242 C806.11145407 7.75387991 810.00436235 7.73037391 813.89794922 7.70507812 C879.18604165 7.5397827 942.95502575 23.76228302 1001.14404297 53.06640625 C1002.31966797 53.64938477 1002.31966797 53.64938477 1003.51904297 54.24414062 C1021.37348235 63.12353593 1038.17427771 74.15339672 1054.14404297 86.06640625 C1054.67755371 86.4624707 1055.21106445 86.85853516 1055.76074219 87.26660156 C1075.60862715 102.05288925 1095.11359819 118.92610619 1111.19482422 137.78125 C1112.69452305 139.53941396 1114.21723312 141.27796875 1115.74951172 143.0078125 C1178.2503531 213.92161969 1208.14404297 306.54870235 1208.14404297 400.06640625 C1150.39404297 400.06640625 1092.64404297 400.06640625 1033.14404297 400.06640625 C1032.15404297 388.84640625 1031.16404297 377.62640625 1030.14404297 366.06640625 C1025.82853006 336.32019228 1017.28692725 308.58850551 1003.14404297 282.06640625 C1002.8029248 281.41752441 1002.46180664 280.76864258 1002.11035156 280.10009766 C993.62682284 264.05370262 983.15052025 249.64602137 971.14404297 236.06640625 C970.34998047 235.14988281 969.55591797 234.23335937 968.73779297 233.2890625 C964.85389508 228.86647329 960.90237908 224.7314102 956.39013672 220.94921875 C954.73086277 219.55831432 953.10232742 218.13054986 951.49169922 216.68359375 C917.54222719 186.44118322 873.94835604 169.33010041 829.14404297 164.06640625 C828.05994141 163.93492187 826.97583984 163.8034375 825.85888672 163.66796875 C792.55167955 160.42062576 757.56691064 164.59340573 726.14404297 176.06640625 C725.33805664 176.3588623 724.53207031 176.65131836 723.70166016 176.95263672 C698.1969985 186.35144785 675.37291217 199.88686694 655.14404297 218.06640625 C654.10767912 218.98057587 653.07122008 219.8946376 652.03466797 220.80859375 C604.83444463 262.83384387 582.25065153 324.19101663 578.09326172 386.0546875 C578.00073773 387.41622774 577.90808741 388.7777594 577.81530762 390.13928223 C577.59031304 393.44824153 577.36659555 396.75728196 577.14404297 400.06640625 C551.39410031 400.16125851 525.64413703 400.22032232 499.89404297 400.25390625 C498.43939015 400.25586061 498.43939015 400.25586061 496.9553504 400.25785446 C434.35735787 400.33963729 371.79233787 399.80799709 309.20654297 398.56640625 C307.84836991 398.53952453 307.84836991 398.53952453 306.46275902 398.51209974 C283.68918128 398.06075884 260.91627529 397.58122834 238.14404297 397.06640625 C238.06232849 395.97975174 237.98061401 394.89309723 237.89642334 393.77351379 C237.58784567 389.68449204 237.27389188 385.59589682 236.95843506 381.50740051 C236.82345711 379.74857842 236.68987554 377.98964852 236.55780029 376.23060608 C232.76406035 325.77153186 216.36604606 276.039548 183.14404297 237.06640625 C182.19716308 235.93511784 181.25057045 234.80358896 180.30419922 233.671875 C171.37776834 223.0606212 162.05302433 213.67416057 151.14404297 205.06640625 C150.16822266 204.27363281 149.19240234 203.48085937 148.18701172 202.6640625 C134.66677622 191.89889386 119.78299906 183.36072633 104.14404297 176.06640625 C103.04318359 175.545625 101.94232422 175.02484375 100.80810547 174.48828125 C45.96968783 149.73935168 -18.8191273 150.05822844 -74.75439453 170.84619141 C-127.57797637 191.62801304 -171.2241906 232.8737628 -194.46142578 284.7734375 C-209.12818317 318.58394067 -215.18232526 352.46080261 -217.85595703 389.06640625 C-258.2838344 389.41480692 -298.6851628 388.79684307 -339.10595703 388.06640625 C-339.7674804 388.05445882 -340.42900376 388.04251139 -341.11057329 388.03020191 C-358.35921548 387.71849075 -375.60766566 387.39694425 -392.85595703 387.06640625 C-392.86902472 384.05914908 -392.87850773 381.05194983 -392.88598633 378.04467773 C-392.89001213 377.20258507 -392.89403793 376.3604924 -392.89818573 375.49288177 C-392.91215614 367.98100274 -392.43451408 360.60492663 -391.66845703 353.12890625 C-391.60315796 352.4782016 -391.53785889 351.82749695 -391.47058105 351.15707397 C-384.55496226 283.04151608 -359.89118998 216.05479588 -318.85595703 161.06640625 C-318.42476563 160.48503906 -317.99357422 159.90367187 -317.54931641 159.3046875 C-305.06266939 142.54074051 -291.06042107 127.21006604 -276.35595703 112.37890625 C-275.48986816 111.49976562 -274.6237793 110.620625 -273.73144531 109.71484375 C-267.75332537 103.72884749 -261.46244764 98.34294976 -254.85595703 93.06640625 C-253.82859068 92.20279944 -252.80518714 91.33440298 -251.78955078 90.45703125 C-182.75215469 31.25125182 -89.92721948 2.09097313 0 0 Z " fill="#002D3A" transform="translate(418.85595703125,-0.06640625)"/>
<path d="M0 0 C23.61054287 -0.11308192 47.20849321 0.19728429 70.81557751 0.57285571 C74.94598735 0.63831436 79.07641887 0.70234787 83.20685029 0.76642853 C92.95499243 0.91771659 102.7030935 1.07146864 112.45117188 1.22680664 C122.44770473 1.38605704 132.44429907 1.54091066 142.44093299 1.69367355 C151.09741542 1.82612152 159.75385104 1.96137429 168.41025567 2.09881264 C173.54901123 2.18037004 178.6877772 2.26090561 183.82659149 2.33868217 C188.64997895 2.41179958 193.4732981 2.48845778 198.2965889 2.56768799 C200.04994659 2.59592523 201.80332383 2.62298131 203.55672073 2.64866829 C209.03904169 2.72943889 214.51934994 2.84182543 220 3 C220.82348781 3.02273271 221.64697561 3.04546542 222.49541759 3.068887 C224.97094968 3.14478093 227.44475019 3.24170779 229.91925049 3.34559631 C230.66864324 3.36777802 231.418036 3.38995973 232.19013762 3.4128136 C236.36939026 3.61555121 239.10009108 4.09527176 242.30078125 6.859375 C243.84960937 8.7109375 243.84960937 8.7109375 245.3125 10.75 C246.51095566 12.2080538 247.7157711 13.66089569 248.92578125 15.109375 C249.56209473 15.89376953 250.1984082 16.67816406 250.85400391 17.48632812 C254.94079499 22.27331345 259.50576047 26.59967461 264 31 C273.59816614 40.45044826 273.59816614 40.45044826 277.375 44.875 C282.25192412 50.56284124 287.67191502 55.74009892 293 61 C298.88944178 66.81407415 304.73723514 72.59036757 310.11328125 78.890625 C314.51047146 83.80673828 319.30739568 88.36744729 324 93 C335.71991784 104.56993718 335.71991784 104.56993718 339.46875 108.96875 C344.45421597 114.81128154 350.03963097 120.10647314 355.5 125.5 C367.78041135 137.6300828 367.78041135 137.6300828 373.13085938 143.90820312 C377.51989377 148.82006921 382.31351886 153.37349211 387 158 C389.10723191 160.08026551 391.21158522 162.16335458 393.3125 164.25 C393.81418701 164.74628906 394.31587402 165.24257813 394.83276367 165.75390625 C398.29893426 169.21258304 401.48815827 172.81295278 404.5 176.671875 C406.16521985 178.44194024 406.16521985 178.44194024 410 178 C412.27827229 176.2596048 412.27827229 176.2596048 414.484375 173.87109375 C415.33773438 173.00033203 416.19109375 172.12957031 417.0703125 171.23242188 C417.95460938 170.31009766 418.83890625 169.38777344 419.75 168.4375 C429.78544074 158.09682701 429.78544074 158.09682701 433.890625 154.59765625 C439.57994043 149.73737583 444.74705802 144.32103567 450 139 C455.81407415 133.11055822 461.59036757 127.26276486 467.890625 121.88671875 C472.80673828 117.48952854 477.36744729 112.69260432 482 108 C487.81407415 102.11055822 493.59036757 96.26276486 499.890625 90.88671875 C504.80673828 86.48952854 509.36744729 81.69260432 514 77 C525.56993718 65.28008216 525.56993718 65.28008216 529.96875 61.53125 C535.81128154 56.54578403 541.10647314 50.96036903 546.5 45.5 C548.67402773 43.29902946 550.85159066 41.10164212 553.03125 38.90625 C553.75193665 38.17311584 553.75193665 38.17311584 554.48718262 37.4251709 C557.19911036 34.69434792 559.98708983 32.15857818 562.93823242 29.68676758 C565.82486861 27.20608657 568.09837691 24.68666003 570.35083008 21.62182617 C574.95080957 15.63379894 579.71746529 10.15161209 587.23187256 8.13092041 C596.21806866 6.99378072 605.24138556 7.62896145 614.25206375 8.17665482 C618.42010475 8.40914224 622.59126682 8.53708535 626.76342773 8.67163086 C632.35607778 8.85738107 637.94783625 9.05206952 643.53877258 9.28431702 C660.84228831 9.9959506 678.14594581 10.3264932 695.4609375 10.578125 C696.16197326 10.58838077 696.86300902 10.59863655 697.58528829 10.6092031 C703.98533394 10.70265368 710.38540882 10.79392924 716.78553104 10.88198376 C725.92785612 11.00805361 735.06985285 11.14794749 744.21176767 11.30090022 C746.2502232 11.33500052 748.28868311 11.36882648 750.32714462 11.40256691 C760.82590295 11.57651 760.82590295 11.57651 765.74493027 11.66036224 C780.83168829 11.91611946 795.91102723 12.05521293 811 12 C810.34 11.01 809.68 10.02 809 9 C844.09943698 3.76429411 879.28433156 0.28304604 914.71712881 -1.63936043 C916.74346067 -1.7496441 918.76960826 -1.86297229 920.79576826 -1.97636414 C987.82829833 -5.66759082 1044.98221656 -1.67906183 1096.89897108 44.47474575 C1114.06209853 59.86841546 1130.00603597 76.31328501 1145.41687608 93.44830871 C1146.81682469 95.0048083 1148.21898438 96.55929357 1149.62139702 98.11357307 C1173.63692644 124.7600734 1196.40941741 152.34811868 1218 181 C1222.43599009 179.45201073 1224.64091438 175.92719294 1227.33334351 172.30563354 C1228.435013 170.85736471 1229.53749221 169.40971157 1230.6406498 167.96257591 C1231.22972217 167.18542945 1231.81879454 166.40828298 1232.42571759 165.60758662 C1250.90212589 141.32946906 1270.61080926 118.09671771 1290.99615872 95.40973747 C1291.91380553 94.38833858 1292.83079269 93.36634664 1293.74711215 92.34375679 C1339.50598787 41.28542179 1383.18512967 1.8274725 1454.20146102 -2.17200118 C1476.03955899 -3.3278136 1497.76300152 -2.93534451 1519.58946812 -1.73676145 C1521.63129483 -1.62465438 1523.67326615 -1.51553178 1525.71527004 -1.4067049 C1560.65873787 0.47664643 1595.37337475 3.92827141 1630 9 C1625.84761502 13.95107373 1621.52951697 18.612545 1616.9522953 23.17075253 C1616.26326927 23.8609324 1615.57424323 24.55111228 1614.86433762 25.2622067 C1612.55894569 27.57024182 1610.25000981 29.87469797 1607.94107056 32.17918396 C1606.26925939 33.85143129 1604.59766804 35.5238984 1602.92627752 37.19656616 C1598.81682754 41.3080178 1594.70506079 45.41714202 1590.59231071 49.52529229 C1585.66473573 54.44762129 1580.74008055 59.37286756 1575.8155277 64.29821976 C1566.72783255 73.38722763 1557.637815 82.47390944 1548.54646683 91.55926323 C1539.54622898 100.55358199 1530.54702779 109.5489359 1521.54920578 118.54567146 C1520.98953412 119.10527438 1520.42986246 119.66487731 1519.85323105 120.24143789 C1517.01089197 123.08343864 1514.16857136 125.92545786 1511.32625787 128.7674842 C1491.19948572 148.89215651 1471.07039659 169.01450987 1450.93994141 189.13549805 C1431.38473004 208.68152355 1411.83057042 228.22860026 1392.27783203 247.77709961 C1391.6750226 248.37977751 1391.07221317 248.98245542 1390.45113678 249.60339629 C1384.39742148 255.65579306 1378.34372753 261.7082112 1372.29004923 267.76064498 C1359.95825025 280.08990782 1347.62630873 292.41902809 1335.29428101 304.74806213 C1334.72728722 305.31491863 1334.16029344 305.88177512 1333.57611802 306.46580909 C1295.71979991 344.31292812 1257.86014899 382.15671322 1220 420 C1216.38040382 418.297997 1214.04175841 416.29084982 1211.20024109 413.44747925 C1210.73215383 412.9818064 1210.26406657 412.51613356 1209.78179485 412.03634942 C1208.21652079 410.47670513 1206.65848956 408.91002308 1205.1003418 407.34326172 C1203.97854081 406.22253386 1202.85630696 405.10223914 1201.7336731 403.98234558 C1198.68555153 400.9390731 1195.6437208 397.88958301 1192.60309958 394.83881903 C1189.41591939 391.64284895 1186.22346183 388.45215847 1183.0316925 385.26077271 C1177.66753325 379.89567656 1172.30726153 374.52672116 1166.94946289 369.15527344 C1160.76805707 362.9581779 1154.58147671 356.76628794 1148.39185399 350.57740009 C1141.79136186 343.97758564 1135.19469337 337.37395941 1128.59912515 330.76922464 C1126.70506563 328.87304094 1124.81030301 326.97756228 1122.91538048 325.08224106 C1119.92614117 322.09199079 1116.93948799 319.09918004 1113.95474625 316.10444069 C1112.86361228 315.0104064 1111.77165423 313.91719324 1110.67877769 312.82489967 C1109.17709149 311.32371104 1107.67855343 309.81944404 1106.18070984 308.31442261 C1105.34430812 307.47634504 1104.5079064 306.63826748 1103.64615917 305.77479362 C1101.65072407 303.68235691 1099.76214724 301.57552469 1097.8836937 299.38285255 C1093.07847005 293.85370772 1087.86424081 288.72922994 1082.68019104 283.55993652 C1081.5354915 282.41480031 1080.39101198 281.26944413 1079.24673218 280.12388849 C1076.11795279 276.99288296 1072.98608063 273.86498744 1069.85367548 270.73760986 C1066.47021942 267.3584852 1063.08966713 263.97645768 1059.70875549 260.5947876 C1053.85607553 254.74158411 1048.00157212 248.89020966 1042.1458149 243.04008484 C1033.67944685 234.58185492 1025.21585199 226.12085452 1016.75292443 217.65918237 C1003.02123984 203.92968465 989.28732505 190.2024201 975.55200195 176.4765625 C962.21196105 163.14570512 948.87297419 149.8137945 935.53540039 136.48046875 C934.71282868 135.65815976 933.89025696 134.83585077 933.04275883 133.98862332 C928.91603239 129.86320195 924.78932663 125.73775989 920.66263115 121.61230755 C886.4449597 87.40499738 852.22366628 53.2013124 818 19 C815.22352142 20.33992143 813.17869455 21.57659341 811.01074219 23.77807617 C810.17902496 24.61486153 810.17902496 24.61486153 809.33050537 25.46855164 C808.74190735 26.07060928 808.15330933 26.67266693 807.546875 27.29296875 C806.92782288 27.91722244 806.30877075 28.54147614 805.67095947 29.18464661 C803.69248853 31.1808997 801.72081257 33.183688 799.75 35.1875 C797.164859 37.80937082 794.57654846 40.42805036 791.984375 43.04296875 C791.047005 43.98872269 791.047005 43.98872269 790.09069824 44.95358276 C786.52007353 48.53598205 782.87474144 51.94375364 779.01269531 55.2121582 C774.11752135 59.56045502 769.59869817 64.34168907 765 69 C759.18592585 74.88944178 753.40963243 80.73723514 747.109375 86.11328125 C742.19326172 90.51047146 737.63255271 95.30739568 733 100 C727.18592585 105.88944178 721.40963243 111.73723514 715.109375 117.11328125 C710.19326172 121.51047146 705.63255271 126.30739568 701 131 C695.18592585 136.88944178 689.40963243 142.73723514 683.109375 148.11328125 C678.19326172 152.51047146 673.63255271 157.30739568 669 162 C663.18592585 167.88944178 657.40963243 173.73723514 651.109375 179.11328125 C646.19326172 183.51047146 641.63255271 188.30739568 637 193 C625.43006282 204.71991784 625.43006282 204.71991784 621.03125 208.46875 C615.18871846 213.45421597 609.89352686 219.03963097 604.5 224.5 C592.3699172 236.78041135 592.3699172 236.78041135 586.09179688 242.13085938 C581.17993079 246.51989377 576.62650789 251.31351886 572 256 C566.18592585 261.88944178 560.40963243 267.73723514 554.109375 273.11328125 C549.19326172 277.51047146 544.63255271 282.30739568 540 287 C534.18592585 292.88944178 528.40963243 298.73723514 522.109375 304.11328125 C517.19326172 308.51047146 512.63255271 313.30739568 508 318 C502.18592585 323.88944178 496.40963243 329.73723514 490.109375 335.11328125 C485.19326172 339.51047146 480.63255271 344.30739568 476 349 C470.18592585 354.88944178 464.40963243 360.73723514 458.109375 366.11328125 C453.19326172 370.51047146 448.63255271 375.30739568 444 380 C432.29023034 391.86156297 432.29023034 391.86156297 425.98828125 397.23876953 C421.80688823 400.94267047 417.92863366 404.96964035 414 408.9375 C412.69482422 410.24944336 412.69482422 410.24944336 411.36328125 411.58789062 C409.23986451 413.72297449 407.11883622 415.86037205 405 418 C398.99906565 413.02639952 393.49681319 407.64642579 388 402.125 C387.13632812 401.26519531 386.27265625 400.40539062 385.3828125 399.51953125 C381.67970526 395.81079619 378.02883626 392.10412646 374.625 388.1171875 C369.74461715 382.43531321 364.3265506 377.25838633 359 372 C353.11055822 366.18592585 347.26276486 360.40963243 341.88671875 354.109375 C337.48952854 349.19326172 332.69260432 344.63255271 328 340 C316.19356382 328.34465167 316.19356382 328.34465167 310.79296875 322.015625 C306.90558614 317.64549553 302.66346978 313.60458053 298.5 309.5 C288.33871201 299.48243603 288.33871201 299.48243603 284.5625 295.0625 C279.86017534 289.57182811 274.64221713 284.57328221 269.5 279.5 C258.31212584 268.46210692 258.31212584 268.46210692 254.53125 264.03125 C249.69366604 258.36901187 244.295982 253.22820892 239 248 C233.11055822 242.18592585 227.26276486 236.40963243 221.88671875 230.109375 C217.48952854 225.19326172 212.69260432 220.63255271 208 216 C202.11055822 210.18592585 196.26276486 204.40963243 190.88671875 198.109375 C186.48952854 193.19326172 181.69260432 188.63255271 177 184 C165.28008216 172.43006282 165.28008216 172.43006282 161.53125 168.03125 C156.54578403 162.18871846 150.96036903 156.89352686 145.5 151.5 C133.21958865 139.3699172 133.21958865 139.3699172 127.86914062 133.09179688 C123.48010623 128.17993079 118.68648114 123.62650789 114 119 C108.11055822 113.18592585 102.26276486 107.40963243 96.88671875 101.109375 C92.48952854 96.19326172 87.69260432 91.63255271 83 87 C77.11055822 81.18592585 71.26276486 75.40963243 65.88671875 69.109375 C61.48952854 64.19326172 56.69260432 59.63255271 52 55 C46.11055822 49.18592585 40.26276486 43.40963243 34.88671875 37.109375 C30.48952854 32.19326172 25.69260432 27.63255271 21 23 C4.42424242 6.63636364 4.42424242 6.63636364 0 0 Z " fill="#BA1319" transform="translate(0,552)"/>
<path d="M0 0 C35.09943698 -5.23570589 70.28433156 -8.71695396 105.71712881 -10.63936043 C107.74346067 -10.7496441 109.76960826 -10.86297229 111.79576826 -10.97636414 C178.82829833 -14.66759082 235.98221656 -10.67906183 287.89897108 35.47474575 C305.06209853 50.86841546 321.00603597 67.31328501 336.41687608 84.44830871 C337.81682469 86.0048083 339.21898438 87.55929357 340.62139702 89.11357307 C364.63692644 115.7600734 387.40941741 143.34811868 409 172 C413.43599009 170.45201073 415.64091438 166.92719294 418.33334351 163.30563354 C419.435013 161.85736471 420.53749221 160.40971157 421.6406498 158.96257591 C422.22972217 158.18542945 422.81879454 157.40828298 423.42571759 156.60758662 C441.90212589 132.32946906 461.61080926 109.09671771 481.99615872 86.40973747 C482.91380553 85.38833858 483.83079269 84.36634664 484.74711215 83.34375679 C530.50598787 32.28542179 574.18512967 -7.1725275 645.20146102 -11.17200118 C667.03955899 -12.3278136 688.76300152 -11.93534451 710.58946812 -10.73676145 C712.63129483 -10.62465438 714.67326615 -10.51553178 716.71527004 -10.4067049 C751.65873787 -8.52335357 786.37337475 -5.07172859 821 0 C816.84761502 4.95107373 812.52951697 9.612545 807.9522953 14.17075253 C807.26326927 14.8609324 806.57424323 15.55111228 805.86433762 16.2622067 C803.55894569 18.57024182 801.25000981 20.87469797 798.94107056 23.17918396 C797.26925939 24.85143129 795.59766804 26.5238984 793.92627752 28.19656616 C789.81682754 32.3080178 785.70506079 36.41714202 781.59231071 40.52529229 C776.66473573 45.44762129 771.74008055 50.37286756 766.8155277 55.29821976 C757.72783255 64.38722763 748.637815 73.47390944 739.54646683 82.55926323 C730.54622898 91.55358199 721.54702779 100.5489359 712.54920578 109.54567146 C711.98953412 110.10527438 711.42986246 110.66487731 710.85323105 111.24143789 C708.01089197 114.08343864 705.16857136 116.92545786 702.32625787 119.7674842 C682.19948572 139.89215651 662.07039659 160.01450987 641.93994141 180.13549805 C622.38473004 199.68152355 602.83057042 219.22860026 583.27783203 238.77709961 C582.6750226 239.37977751 582.07221317 239.98245542 581.45113678 240.60339629 C575.39742148 246.65579306 569.34372753 252.7082112 563.29004923 258.76064498 C550.95825025 271.08990782 538.62630873 283.41902809 526.29428101 295.74806213 C525.72728722 296.31491863 525.16029344 296.88177512 524.57611802 297.46580909 C486.71979991 335.31292812 448.86014899 373.15671322 411 411 C407.38040382 409.297997 405.04175841 407.29084982 402.20024109 404.44747925 C401.73215383 403.9818064 401.26406657 403.51613356 400.78179485 403.03634942 C399.21652079 401.47670513 397.65848956 399.91002308 396.1003418 398.34326172 C394.97854081 397.22253386 393.85630696 396.10223914 392.7336731 394.98234558 C389.68555153 391.9390731 386.6437208 388.88958301 383.60309958 385.83881903 C380.41591939 382.64284895 377.22346183 379.45215847 374.0316925 376.26077271 C368.66753325 370.89567656 363.30726153 365.52672116 357.94946289 360.15527344 C351.76805707 353.9581779 345.58147671 347.76628794 339.39185399 341.57740009 C332.79136186 334.97758564 326.19469337 328.37395941 319.59912515 321.76922464 C317.70506563 319.87304094 315.81030301 317.97756228 313.91538048 316.08224106 C310.92614117 313.09199079 307.93948799 310.09918004 304.95474625 307.10444069 C303.86361228 306.0104064 302.77165423 304.91719324 301.67877769 303.82489967 C300.17709149 302.32371104 298.67855343 300.81944404 297.18070984 299.31442261 C296.34430812 298.47634504 295.5079064 297.63826748 294.64615917 296.77479362 C292.65080664 294.6824435 290.76232668 292.57571169 288.88396358 290.38312244 C284.07732359 284.85235384 278.86144447 279.72643614 273.6758728 274.55561829 C272.53061193 273.40992074 271.38557108 272.26400321 270.24072993 271.11788625 C267.11020209 267.98513216 263.97658129 264.85548828 260.84242773 261.72636211 C257.45683097 258.34509686 254.07413811 254.96092863 250.69108582 251.57711792 C244.83350591 245.71901442 238.97410208 239.86274043 233.11344528 234.00771523 C224.63454862 225.53696032 216.15842855 217.06343152 207.68297441 208.58923235 C193.92374369 194.83218884 180.16228296 181.07737833 166.39941406 167.32397461 C153.04505469 153.97878986 139.69174233 140.63255891 126.33984375 127.28491211 C125.10574621 126.05120865 125.10574621 126.05120865 123.8467174 124.79258189 C119.71846243 120.66563218 115.59022821 116.53866172 111.46200442 112.41168082 C83.01794257 83.97622546 54.57166345 55.54298962 26.12312317 27.11201477 C25.51666162 26.50592739 24.91020008 25.89984001 24.28536091 25.27538634 C21.47783224 22.46959499 18.67029173 19.6638155 15.86272466 16.85806257 C15.36353729 16.3591923 14.86434993 15.86032203 14.35003567 15.34633449 C13.02971923 14.02685726 11.70939492 12.7073879 10.38906991 11.38791925 C9.60067684 10.5999059 8.81228377 9.81189254 8 9 C7.1108728 8.12124291 6.2217456 7.24248582 5.30567515 6.33709973 C3.31425627 4.31853934 1.62834877 2.31396931 0 0 Z " fill="#EF4522" transform="translate(809,561)"/>
<path d="M0 0 C4.17043995 0.23290944 8.34400933 0.36189157 12.51856232 0.49737549 C18.11353763 0.68416724 23.70763606 0.87962263 29.30091095 1.11239624 C46.56499251 1.82262337 63.82839523 2.13257445 81.10401154 2.36651611 C82.51675641 2.3859388 83.92950093 2.40538678 85.3422451 2.42486 C91.02101947 2.50282325 96.69981136 2.57938525 102.37863445 2.65371799 C116.15637198 2.83419502 129.93363519 3.03897734 143.71074104 3.26255226 C147.38172919 3.32130278 151.05275943 3.37633559 154.72380829 3.43113708 C161.39941375 3.53485528 168.07386174 3.67241638 174.74854279 3.82354736 C175.92084694 3.84707275 177.09315109 3.87059814 178.30097961 3.89483643 C181.78884222 3.96979082 185.2755307 4.06553705 188.76270294 4.16729736 C190.35653085 4.19817444 190.35653085 4.19817444 191.9825573 4.22967529 C193.44847533 4.27904236 193.44847533 4.27904236 194.94400787 4.32940674 C195.80237055 4.35240845 196.66073322 4.37541016 197.54510689 4.39910889 C200.17112123 4.90494685 201.08229386 5.78313768 202.74854279 7.82354736 C201.45675498 10.66370044 200.10071195 12.72053124 197.89453888 14.92047119 C197.31988892 15.49819778 196.74523895 16.07592438 196.15317535 16.67115784 C195.53238098 17.28476669 194.91158661 17.89837555 194.27198029 18.53057861 C193.30586319 19.49600838 193.30586319 19.49600838 192.32022858 20.48094177 C190.95576141 21.84239034 189.58886711 23.20141011 188.21973419 24.5581665 C186.14680584 26.61298751 184.08184299 28.67554723 182.01807404 30.73956299 C180.68651064 32.06620462 179.35449329 33.3923908 178.02198029 34.71807861 C177.4133313 35.32561478 176.80468231 35.93315094 176.17758942 36.55909729 C172.44992688 40.24669341 168.59604471 43.731064 164.63150787 47.16172791 C161.97134028 49.509471 159.49198824 51.98590557 156.99854279 54.51104736 C156.49613068 55.01724609 155.99371857 55.52344482 155.47608185 56.04498291 C153.89771567 57.63536586 152.32269269 59.22899181 150.74854279 60.82354736 C144.93446863 66.71298914 139.15817522 72.5607825 132.85791779 77.93682861 C127.94180451 82.33401882 123.3810955 87.13094304 118.74854279 91.82354736 C112.93446863 97.71298914 107.15817522 103.5607825 100.85791779 108.93682861 C95.94180451 113.33401882 91.3810955 118.13094304 86.74854279 122.82354736 C80.93446863 128.71298914 75.15817522 134.5607825 68.85791779 139.93682861 C63.94180451 144.33401882 59.3810955 149.13094304 54.74854279 153.82354736 C48.93446863 159.71298914 43.15817522 165.5607825 36.85791779 170.93682861 C31.94180451 175.33401882 27.3810955 180.13094304 22.74854279 184.82354736 C11.17860561 196.54346521 11.17860561 196.54346521 6.77979279 200.29229736 C0.93726124 205.27776333 -4.35793036 210.86317833 -9.75145721 216.32354736 C-21.88154001 228.60395872 -21.88154001 228.60395872 -28.15966034 233.95440674 C-33.07152642 238.34344114 -37.62494933 243.13706622 -42.25145721 247.82354736 C-53.82164457 259.54371863 -53.82164457 259.54371863 -58.23583221 263.30401611 C-61.70827546 266.26564752 -64.93421786 269.44430793 -68.14208221 272.68682861 C-68.65911713 273.20937225 -69.17615204 273.73191589 -69.70885468 274.27029419 C-71.85494528 276.4440867 -73.99725564 278.62152367 -76.13524628 280.80328369 C-77.71646819 282.4146943 -79.30384753 284.0198338 -80.89208221 285.62432861 C-81.37131134 286.11701736 -81.85054047 286.60970612 -82.34429169 287.11732483 C-84.80167988 289.5929863 -87.00057297 291.50555691 -90.25145721 292.82354736 C-93.54458548 289.55539906 -96.83421486 286.28378041 -100.12084198 283.00909424 C-101.23613012 281.89879153 -102.35231932 280.78939307 -103.46947479 279.68096924 C-108.95378215 274.23841433 -114.36200108 268.79723067 -119.38011932 262.91534424 C-123.77246823 258.00554053 -128.56448595 253.4505391 -133.25145721 248.82354736 C-139.14089899 243.00947321 -144.98869235 237.23317979 -150.36473846 230.93292236 C-154.76192868 226.01680908 -159.55885289 221.45610008 -164.25145721 216.82354736 C-175.99667755 205.22863149 -175.99667755 205.22863149 -181.36522675 198.93682861 C-185.74887719 194.02550603 -190.51619748 189.45810622 -195.18895721 184.82354736 C-196.26536375 183.75216849 -197.34153736 182.68055554 -198.41747284 181.60870361 C-201.02612466 179.01095099 -203.63790193 176.41636774 -206.25145721 173.82354736 C-204.7423571 170.28234678 -202.68026407 168.00750372 -199.96239471 165.30401611 C-199.10259003 164.44614502 -198.24278534 163.58827393 -197.35692596 162.70440674 C-196.45587128 161.81559814 -195.55481659 160.92678955 -194.62645721 160.01104736 C-193.74860565 159.13384033 -192.87075409 158.2566333 -191.96630096 157.35284424 C-188.18708375 153.59889668 -184.40491301 149.89655437 -180.35301971 146.43682861 C-174.67735068 141.55959144 -169.50513175 136.14532508 -164.25145721 130.82354736 C-158.43738306 124.93410558 -152.66108965 119.08631223 -146.36083221 113.71026611 C-141.44471893 109.3130759 -136.88400993 104.51615169 -132.25145721 99.82354736 C-126.43738306 93.93410558 -120.66108965 88.08631223 -114.36083221 82.71026611 C-109.44471893 78.3130759 -104.88400993 73.51615169 -100.25145721 68.82354736 C-88.68152004 57.10362952 -88.68152004 57.10362952 -84.28270721 53.35479736 C-78.44017567 48.3693314 -73.14498407 42.78391639 -67.75145721 37.32354736 C-65.57742948 35.12257682 -63.39986656 32.92518948 -61.22020721 30.72979736 C-60.73974945 30.24104126 -60.25929169 29.75228516 -59.7642746 29.24871826 C-57.05234686 26.51789528 -54.26436739 23.98212554 -51.31322479 21.51031494 C-48.42658861 19.02963394 -46.15308031 16.51020739 -43.90062714 13.44537354 C-31.84409386 -2.24922896 -18.06103995 -1.0982448 0 0 Z " fill="#A70E13" transform="translate(614.2514572143555,560.1764526367188)"/>
<path d="M0 0 C14.58789576 12.27310108 25.21858271 26.77876532 30.92089844 45.09326172 C31.23929688 46.09744141 31.55769531 47.10162109 31.88574219 48.13623047 C37.89895601 70.88668461 34.2956699 95.86506329 23.13964844 116.36669922 C18.80846359 123.74002581 13.8618522 129.9673332 7.92089844 136.09326172 C7.38207031 136.70556641 6.84324219 137.31787109 6.28808594 137.94873047 C-6.35742366 151.83337291 -28.11802641 161.21224843 -46.61791992 162.23339844 C-74.63222001 163.17556765 -97.44063497 157.24135655 -118.85644531 138.68701172 C-135.39031529 122.99384699 -146.48792879 100.53101637 -147.28222656 77.59716797 C-147.72225746 50.0228265 -139.49929878 26.15836107 -120.07910156 6.09326172 C-87.8804368 -24.63967821 -35.06787765 -28.32405502 0 0 Z " fill="#002D3A" transform="translate(1290.0791015625,340.90673828125)"/>
<path d="M0 0 C18.81 0 37.62 0 57 0 C57.020625 7.528125 57.04125 15.05625 57.0625 22.8125 C57.071604 25.16608643 57.08070801 27.51967285 57.09008789 29.94458008 C57.09301301 31.84456323 57.09556016 33.74454701 57.09765625 35.64453125 C57.10277222 36.60307007 57.10788818 37.56160889 57.11315918 38.54919434 C57.11398793 45.0839222 56.69699661 51.50307878 56 58 C51.41829805 58.0253888 46.83664005 58.04317148 42.25488281 58.05493164 C40.70767501 58.05985198 39.16047155 58.06658787 37.61328125 58.07543945 C24.71664984 58.14718119 11.87805067 57.67987864 -1 57 C-1.0255149 50.48959192 -1.04293568 43.97919691 -1.05493164 37.46875 C-1.0599367 35.25748208 -1.06674276 33.04621742 -1.07543945 30.83496094 C-1.08767359 27.64256988 -1.09326674 24.45022286 -1.09765625 21.2578125 C-1.10281754 20.28135773 -1.10797882 19.30490295 -1.11329651 18.29885864 C-1.11337204 17.35863861 -1.11344757 16.41841858 -1.11352539 15.44970703 C-1.115746 14.6369632 -1.11796661 13.82421936 -1.12025452 12.98684692 C-0.94545953 8.64533946 -0.43234613 4.32346125 0 0 Z " fill="#002D3A" transform="translate(354,478)"/>
<path d="M0 0 C6.34968192 -0.02555006 12.69935037 -0.04295013 19.04907227 -0.05493164 C21.20500178 -0.05993155 23.36092796 -0.06673365 25.5168457 -0.07543945 C28.63233265 -0.08769663 31.74777441 -0.09327188 34.86328125 -0.09765625 C36.28741081 -0.10539818 36.28741081 -0.10539818 37.74031067 -0.11329651 C44.27561452 -0.11383298 50.4326443 0.40296766 57 1 C57 19.81 57 38.62 57 58 C49.471875 58.020625 41.94375 58.04125 34.1875 58.0625 C31.83391357 58.071604 29.48032715 58.08070801 27.05541992 58.09008789 C25.15543677 58.09301301 23.25545299 58.09556016 21.35546875 58.09765625 C20.39692993 58.10277222 19.43839111 58.10788818 18.45080566 58.11315918 C11.9160778 58.11398793 5.49692122 57.69699661 -1 57 C-1.12854031 37.96244818 -0.82750421 19.02159272 0 0 Z " fill="#002D3A" transform="translate(428,479)"/>
<path d="M0 0 C13.62605849 0 27.20007124 0.09078949 40.8125 0.5 C42.49934111 0.54845095 44.1861901 0.59662862 45.87304688 0.64453125 C49.91546149 0.75989919 53.95775427 0.87886472 58 1 C58.07636818 13.86273531 57.83805165 26.70453864 57.5 39.5625 C57.335 45.976875 57.17 52.39125 57 59 C37.86 58.67 18.72 58.34 -1 58 C-0.67 38.86 -0.34 19.72 0 0 Z " fill="#002D3A" transform="translate(429,399)"/>
<path d="M0 0 C3.93879158 -0.02568949 7.87754772 -0.04329749 11.81640625 -0.05493164 C13.77605922 -0.06213625 15.73568957 -0.07486655 17.6953125 -0.08789062 C30.84282746 -0.12011493 43.81929799 0.49304992 57 1 C57 19.81 57 38.62 57 58 C37.86 58 18.72 58 -1 58 C-1.08771341 38.61533567 -0.89475756 19.36341033 0 0 Z " fill="#002D3A" transform="translate(355,398)"/>
</svg>


                <span>WoodLand</span>
            </router-link>
        </div>


        <!-- ACTIONS -->
        <div class="layout-topbar-actions">
            <div class="layout-config-menu">
                <button
                    type="button"
                    class="layout-topbar-action"
                    @click="toggleDarkMode"
                >
                    <i :class="[ 'pi', { 'pi-moon': isDarkTheme, 'pi-sun': !isDarkTheme } ]"></i>
                </button>

            </div>
           <!--   appconfigurator -->
        </div>

        <!-- USER AVATAR MENU -->
       <div class="relative">
  <button
    v-ripple
    class="relative overflow-hidden border-0 bg-transparent flex items-center p-1 pl-2 hover:bg-surface-100 dark:hover:bg-surface-800 rounded cursor-pointer transition-colors duration-200 min-w-fit"
    @click="menu.toggle($event)"
    aria-haspopup="true"
    aria-controls="user_menu"
  >
    <Avatar
      :image="user.image_url ? `http://localhost:5000/uploads/users/${user.image_url}` : 'https://primefaces.org/cdn/primevue/images/avatar/amyelsner.png'"
      class="mr-2 border-2 border-blue-300 shadow-lg"
      shape="circle"
      size="large"
    />
    <span class="inline-flex flex-col items-start">
      <span class="font-bold leading-tight text-sm ml-1">{{ user.name }}</span>
      <Tag
        :value="user.role"
        severity="info"
        class="mt-1 text-xs px-2 py-0.5 rounded-full font-semibold shadow-none bg-blue-100 text-blue-700 border-0"
        style="letter-spacing: 0.01em;"
      />
    </span>
    <i class="pi pi-chevron-down ml-2 text-xs"></i>
  </button>
  <Menu ref="menu" :model="userMenuItems" popup id="user_menu" appendTo="body"/>
</div>

        <!-- SETTINGS MODAL (optional, can be a popover or modal) -->

        <Dialog
  v-model:visible="showConfigurator"
  :dismissable-mask="true"
  modal
  header="Settings"
  :style="{ width: '400px' }"
>
  <div class="space-y-4">
    <!-- Read-only profile info -->
    <div class="flex items-center gap-3">
      <Avatar
        :image="settingsForm.image_url ? `http://localhost:5000/uploads/users/${settingsForm.image_url}` : 'https://primefaces.org/cdn/primevue/images/avatar/amyelsner.png'"
        class="border-2 border-gray-300 shadow-lg"
        shape="circle"
        size="xlarge"
      />
      <div class="text-xs text-gray-500">Profile details are read-only.</div>
    </div>

    <div>
      <label class="block mb-1 font-semibold text-xs">Name</label>
      <InputText v-model="settingsForm.name" class="w-full" disabled />
    </div>

    <div>
      <label class="block mb-1 font-semibold text-xs">Email</label>
      <InputText v-model="settingsForm.email" class="w-full" disabled />
    </div>

    <!-- Password change -->
    <div>
      <label class="block mb-1 text-sm font-medium text-gray-700">New Password</label>
      <Password v-model="settingsForm.password" toggleMask class="w-full" inputClass="w-full" />
    </div>

    <div>
      <label class="block mb-1 text-sm font-medium text-gray-700">Confirm Password</label>
      <Password v-model="confirmPassword" toggleMask class="w-full" inputClass="w-full" />
      <div
        v-if="settingsForm.password && confirmPassword && settingsForm.password !== confirmPassword"
        class="text-red-500 text-xs mt-1"
      >
        Passwords do not match.
      </div>
    </div>

    <div v-if="settingsError" class="text-red-500 text-xs">{{ settingsError }}</div>
  </div>

  <template #footer>
    <Button label="Close" @click="closeConfigurator" class="p-button-secondary p-button-sm" />
    <Button
      label="Save Changes"
      @click="saveSettings"
      class="p-button-primary p-button-sm"
    />
  </template>
</Dialog>


    </div>
    <Toast />

</template>

<style scoped>
/* High-quality avatar styling */
:deep(.p-avatar img) {
  object-fit: cover;
  object-position: center;
  width: 100%;
  height: 100%;
  image-rendering: -webkit-optimize-contrast;
  image-rendering: crisp-edges;
  image-rendering: optimize-quality;
}

/* Ensure avatars maintain proper sizing */
:deep(.p-avatar.p-avatar-circle) {
  overflow: hidden;
}

/* Large avatar in topbar */
:deep(.p-avatar-lg) {
  width: 3rem;
  height: 3rem;
}

/* Extra large avatar in settings */
:deep(.p-avatar-xl) {
  width: 5rem;
  height: 5rem;
}

/* Improve image loading */
:deep(.p-avatar img) {
  transition: all 0.3s ease;
  background-color: #f8fafc;
}

/* Hover effect for topbar avatar */
.layout-topbar-actions .p-avatar:hover {
  transform: scale(1.05);
  transition: transform 0.2s ease;
}

/* Password field styling */
:deep(.p-password) {
  width: 100%;
}

:deep(.p-password .p-inputtext) {
  width: 100%;
}
</style>
